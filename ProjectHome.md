My code (collaborated with Rodion)